const marketAddress = "0xa2e126125b4f46cb048ae4122e963f6d8ea05306";

const marketABI = [{ "inputs": [{ "internalType": "address", "name": "systemCheckerContractAddress", "type": "address" }, { "internalType": "address", "name": "treasuryContractAddress", "type": "address" }, { "internalType": "address", "name": "itemFactoryContractAddress", "type": "address" }, { "internalType": "address", "name": "marketVaultContractAddress", "type": "address" }], "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "uint256", "name": "listingId", "type": "uint256" }, { "indexed": false, "internalType": "address", "name": "seller", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "tokenId", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "price", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "priceWithFee", "type": "uint256" }], "name": "LogNewListing", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "uint256", "name": "listingId", "type": "uint256" }, { "indexed": false, "internalType": "address", "name": "seller", "type": "address" }, { "indexed": false, "internalType": "address", "name": "buyer", "type": "address" }], "name": "LogPurchase", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "uint256", "name": "listingId", "type": "uint256" }, { "indexed": false, "internalType": "address", "name": "seller", "type": "address" }, { "indexed": false, "internalType": "bool", "name": "isSale", "type": "bool" }], "name": "LogRemoveListing", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "uint256", "name": "feeBp", "type": "uint256" }], "name": "LogSetFee", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "address", "name": "itemFactoryContractAddress", "type": "address" }], "name": "LogSetItemFactoryAddress", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "address", "name": "marketVaultContractAddress", "type": "address" }], "name": "LogSetMarketVaultContractAddress", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "address", "name": "treasuryContractAddress", "type": "address" }], "name": "LogSetTreasuryContractAddress", "type": "event" }, { "inputs": [], "name": "PET_BYTES", "outputs": [{ "internalType": "bytes32", "name": "", "type": "bytes32" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "_itemFactoryContractAddress", "outputs": [{ "internalType": "address", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "_listingId", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "_marketVaultContractAddress", "outputs": [{ "internalType": "address", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "_saleFeeBp", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "_systemCheckerContractAddress", "outputs": [{ "internalType": "address", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "_treasuryContractAddress", "outputs": [{ "internalType": "address", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "buyer", "type": "address" }, { "internalType": "uint256", "name": "listingId", "type": "uint256" }], "name": "buyListing", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "tokenId", "type": "uint256" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }, { "internalType": "uint256", "name": "price", "type": "uint256" }, { "internalType": "address", "name": "seller", "type": "address" }], "name": "createListing", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "listingId", "type": "uint256" }], "name": "getListing", "outputs": [{ "components": [{ "internalType": "address", "name": "seller", "type": "address" }, { "internalType": "uint256", "name": "id", "type": "uint256" }, { "internalType": "uint256", "name": "tokenId", "type": "uint256" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }, { "internalType": "uint256", "name": "listingTime", "type": "uint256" }, { "internalType": "uint256", "name": "price", "type": "uint256" }, { "internalType": "uint256", "name": "listedPrice", "type": "uint256" }], "internalType": "struct MarketplaceV2.ListingStruct", "name": "", "type": "tuple" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getListingIds", "outputs": [{ "internalType": "bytes32[]", "name": "", "type": "bytes32[]" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "bytes[]", "name": "data", "type": "bytes[]" }, { "internalType": "bool", "name": "revertOnFail", "type": "bool" }], "name": "multicall", "outputs": [{ "internalType": "bytes[]", "name": "returning", "type": "bytes[]" }], "stateMutability": "payable", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "listingId", "type": "uint256" }, { "internalType": "address", "name": "seller", "type": "address" }], "name": "removeListing", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "feeBp", "type": "uint256" }], "name": "setFee", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "itemFactoryContractAddress", "type": "address" }], "name": "setItemFactoryContractAddress", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "marketVaultContractAddress", "type": "address" }], "name": "setMarketVaultContractAddress", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "systemCheckerContractAddress", "type": "address" }], "name": "setSystemCheckerContractAddress", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "treasuryContractAddress", "type": "address" }], "name": "setTreasuryContractAddress", "outputs": [], "stateMutability": "nonpayable", "type": "function" }];

const itemsAddress = "0x88883145049dec03c00cb7708cbc938058802520";
const itemsABI = [{"inputs":[{"internalType":"string","name":"uri","type":"string"},{"internalType":"address","name":"systemCheckerContractAddress","type":"address"},{"internalType":"address","name":"treasuryContractAddress","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"owner","type":"address"},{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"LogBurnItem","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"buyer","type":"address"},{"indexed":false,"internalType":"uint256","name":"quantity","type":"uint256"}],"name":"LogBuyBox","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"owner","type":"address"},{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"LogMintItem","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"categoryKey","type":"bytes32"}],"name":"LogNewCategory","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"categoryKey","type":"bytes32"},{"indexed":false,"internalType":"bytes32","name":"typeKey","type":"bytes32"},{"indexed":false,"internalType":"uint256","name":"itemId","type":"uint256"}],"name":"LogNewItem","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"categoryKey","type":"bytes32"},{"indexed":false,"internalType":"bytes32","name":"typeKey","type":"bytes32"}],"name":"LogNewType","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"buyer","type":"address"},{"indexed":false,"internalType":"uint256[]","name":"itemIds","type":"uint256[]"}],"name":"LogOpenBox","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"categoryKey","type":"bytes32"}],"name":"LogRemoveCategory","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"itemId","type":"uint256"}],"name":"LogRemoveItem","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"categoryKey","type":"bytes32"},{"indexed":false,"internalType":"bytes32","name":"typeKey","type":"bytes32"}],"name":"LogRemoveType","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"price","type":"uint256"}],"name":"LogSetBoxPrice","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"boxRewardCount","type":"uint256"}],"name":"LogSetBoxRewardCount","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"treasuryContractAddress","type":"address"}],"name":"LogSetTreasuryContractAddress","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"newUri","type":"string"}],"name":"LogSetUri","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"indexed":false,"internalType":"uint256[]","name":"values","type":"uint256[]"}],"name":"TransferBatch","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"TransferSingle","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"value","type":"string"},{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"}],"name":"URI","type":"event"},{"inputs":[],"name":"PET_BYTES","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_boxPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_boxRewardCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_systemCheckerContractAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_treasuryContractAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address[]","name":"accounts","type":"address[]"},{"internalType":"uint256[]","name":"ids","type":"uint256[]"}],"name":"balanceOfBatch","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"burnItem","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"quantity","type":"uint256"}],"name":"buyBox","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"exists","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"gameSafeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getCategories","outputs":[{"internalType":"bytes32[]","name":"","type":"bytes32[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getItemById","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"},{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getItems","outputs":[{"components":[{"internalType":"bytes32","name":"categoryKey","type":"bytes32"},{"internalType":"bytes32","name":"typeKey","type":"bytes32"},{"internalType":"uint256","name":"id","type":"uint256"}],"internalType":"struct ItemFactoryV3.ItemStruct[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTypes","outputs":[{"internalType":"bytes32[]","name":"","type":"bytes32[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"mintItem","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes[]","name":"data","type":"bytes[]"},{"internalType":"bool","name":"revertOnFail","type":"bool"}],"name":"multicall","outputs":[{"internalType":"bytes[]","name":"returning","type":"bytes[]"}],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"categoryKey","type":"bytes32"}],"name":"newCategory","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"categoryKey","type":"bytes32"},{"internalType":"bytes32","name":"typeKey","type":"bytes32"},{"internalType":"uint256","name":"itemId","type":"uint256"}],"name":"newItem","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"categoryKey","type":"bytes32"},{"internalType":"bytes32","name":"typeKey","type":"bytes32"}],"name":"newType","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"entropy","type":"uint256"}],"name":"openBox","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"categoryKey","type":"bytes32"}],"name":"removeCategory","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"itemId","type":"uint256"}],"name":"removeItem","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"categoryKey","type":"bytes32"},{"internalType":"bytes32","name":"typeKey","type":"bytes32"}],"name":"removeType","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"internalType":"uint256[]","name":"amounts","type":"uint256[]"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeBatchTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"price","type":"uint256"}],"name":"setBoxPrice","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"boxRewardCount","type":"uint256"}],"name":"setBoxRewardCount","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"systemCheckerContractAddress","type":"address"}],"name":"setSystemCheckerContractAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"treasuryContractAddress","type":"address"}],"name":"setTreasuryContractAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"newUri","type":"string"}],"name":"setUri","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"uri","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"}];

const treasuryAddress = "0x11d97f31b489b9c57507839530ab9ea910979c68";
const treasuryABI = [{ "inputs": [{ "internalType": "address", "name": "systemCheckerContractAddress", "type": "address" }, { "internalType": "address", "name": "milkChildContractAddress", "type": "address" }], "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "address", "name": "user", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "gold", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "time", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "uuid", "type": "uint256" }], "name": "LogGoldClaimed", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "uint256", "name": "baseRate", "type": "uint256" }], "name": "LogSetBaseRate", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "uint256[]", "name": "catClass", "type": "uint256[]" }, { "indexed": false, "internalType": "uint256[]", "name": "bonus", "type": "uint256[]" }], "name": "LogSetCatClassBonus", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "address", "name": "milkChildContractAddress", "type": "address" }], "name": "LogSetMilkChildContractAddress", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "uint256", "name": "timestamp", "type": "uint256" }], "name": "LogSetStartTime", "type": "event" }, { "inputs": [], "name": "PET_BYTES", "outputs": [{ "internalType": "bytes32", "name": "", "type": "bytes32" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "_baseRate", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "name": "_catClassBonus", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "_contractStartTime", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "name": "_lastUpdate", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "_milkChildContractAddress", "outputs": [{ "internalType": "address", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "_systemCheckerContractAddress", "outputs": [{ "internalType": "address", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "user", "type": "address" }], "name": "balanceOf", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "owner", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "burn", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "uint256[]", "name": "catIds", "type": "uint256[]" }, { "internalType": "uint256[]", "name": "catClasses", "type": "uint256[]" }], "name": "calcClaim", "outputs": [{ "internalType": "uint256", "name": "reward", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "owner", "type": "address" }, { "internalType": "uint256[]", "name": "catIds", "type": "uint256[]" }, { "internalType": "uint256[]", "name": "catClasses", "type": "uint256[]" }, { "internalType": "uint256", "name": "uuid", "type": "uint256" }], "name": "claim", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "to", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "mint", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "bytes[]", "name": "data", "type": "bytes[]" }, { "internalType": "bool", "name": "revertOnFail", "type": "bool" }], "name": "multicall", "outputs": [{ "internalType": "bytes[]", "name": "returning", "type": "bytes[]" }], "stateMutability": "payable", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "baseRate", "type": "uint256" }], "name": "setBaseRate", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "uint256[]", "name": "catClass", "type": "uint256[]" }, { "internalType": "uint256[]", "name": "bonus", "type": "uint256[]" }], "name": "setCatClassBonus", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "milkChildContractAddress", "type": "address" }], "name": "setMilkChildContractAddress", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "timestamp", "type": "uint256" }], "name": "setStartTime", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "systemCheckerContractAddress", "type": "address" }], "name": "setSystemCheckerContractAddress", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "sender", "type": "address" }, { "internalType": "address", "name": "recipient", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "transferFrom", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "owner", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "withdraw", "outputs": [], "stateMutability": "nonpayable", "type": "function" }];

const polygonWeb3 = new Web3("wss://rpc-mainnet.matic.quiknode.pro");

const itemsContract = new polygonWeb3.eth.Contract(itemsABI, itemsAddress);
const marketContract = new polygonWeb3.eth.Contract(marketABI, marketAddress);
const treasuryContract = new polygonWeb3.eth.Contract(treasuryABI, treasuryAddress);

function parseEvent(event) {
    eventObj = document.createElement("div");
    eventObj.className = "text-center";

    let eventTitle = document.createElement("h5");
    eventTitle.className = "alert-heading";
    eventTitle.innerHTML = '<a href="https://polygonscan.com/tx/' + event.transactionHash + '">' + event.event.substring(3, event.event.length) + "</a>";

    let eventBody = document.createElement("p");
    eventBody.className = "font-monospace";

    let val = event.returnValues;

    switch (event.event) {
        case "LogBurnItem":
            eventBody.innerHTML = val.owner + ' burned <img src="https://metadata.coolcatsnft.com/item/image/' + val.tokenId + '.png" width="50">x' + val.amount;
            break;
        case "LogBuyBox":
            eventBody.innerHTML = val.buyer + ' bought <img src="https://metadata.coolcatsnft.com/item/image/1.png" width="50">x' + val.quantity;
            break;
        case "LogOpenBox":
            eventBody.innerHTML = val.buyer + ' got ';
            val.itemIds.forEach(function (id) {
                eventBody.innerHTML += '<img src="https://metadata.coolcatsnft.com/item/image/' + id + '.png" width="50">';
            });
            break;

        case "LogNewListing":
            eventBody.innerHTML = val.seller + " listed ";
            for (let i = 0; i < val.amount; i++) {
                eventBody.innerHTML += '<img src="https://metadata.coolcatsnft.com/item/image/' + val.tokenId + '.png" width="50">';
            }
            eventBody.innerHTML += " for " + (val.price * 1e-18).toFixed(2) + " MILK";
            break;

            case "LogGoldClaimed":
                eventBody.textContent = val.user + " claimed " + (val.gold * 1e-18).toFixed(2) + " MILK";
    }

    eventObj.appendChild(eventTitle);
    eventObj.appendChild(eventBody);
    return eventObj;
}

function getEvents() {
    itemsContract.events.allEvents({fromBlock: "latest"}
    ).on("connected", function(subscriptionId){
        console.log("CONNECTED", subscriptionId);
    }).on('data', function(event){
        if (["LogBurnItem", "LogBuyBox", "LogOpenBox"].includes(event.event)) {
            let eventObj = parseEvent(event);
            let mainContainer = document.querySelector("#main");
            let mainChilds = mainContainer.childNodes;

            mainContainer.prepend(eventObj);

            if (mainChilds.length > 10) {
                mainContainer.removeChild(mainChilds[mainChilds.length - 1]);
            }
        }
    }).on('error', function(error, receipt) {
        console.log("ERROR", error, receipt);
    });

    marketContract.events.LogNewListing({ fromBlock: "latest" }
    ).on("connected", function (subscriptionId) {
        console.log("CONNECTED", subscriptionId);
    }).on('data', function (event) {
        let eventObj = parseEvent(event);
        let mainContainer = document.querySelector("#main");
        let mainChilds = mainContainer.childNodes;

        mainContainer.prepend(eventObj);

        if (mainChilds.length > 10) {
            mainContainer.removeChild(mainChilds[mainChilds.length - 1]);
        }
    }).on('error', function (error, receipt) {
        console.log("ERROR", error, receipt);
    });

    treasuryContract.events.LogGoldClaimed({ fromBlock: "latest" }
    ).on("connected", function (subscriptionId) {
        console.log("CONNECTED", subscriptionId);
    }).on('data', function (event) {
        let eventObj = parseEvent(event);
        let mainContainer = document.querySelector("#main");
        let mainChilds = mainContainer.childNodes;

        mainContainer.prepend(eventObj);

        if (mainChilds.length > 20) {
            mainContainer.removeChild(mainChilds[mainChilds.length - 1]);
        }
    
    }).on('error', function (error, receipt) {
        console.log("ERROR", error, receipt);
    });
}

getEvents();